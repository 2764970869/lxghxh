<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="./source/lxghxh.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>With My Love Huahua Calendar</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: 'Georgia', serif;
            color: #333;
            overflow: hidden;
            position: relative;
            transition: background 1s ease;
            /* background-image: url('./57.jpg'); */
            background-size: cover;
            background-blend-mode: overlay;
        }

        .tooltip {
            position: fixed;
            top: 80px;
            /* ç¨å¾®ä¸‹ç§»äº†ä¸€ç‚¹ */
            left: 72%;
            transform: translateX(-50%);
            z-index: 1000;
            border-radius: 15px;
            /* åœ†è§’æ›´å°ä¸€äº› */
            font-size: 15px;
            /* å­—ä½“å¤§å°è°ƒæ•´ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
            /* æ›´æŸ”å’Œçš„é˜´å½± */
            padding: 12px 24px;
            /* å¢åŠ å†…è¾¹è· */
            border: none;
            /* ç§»é™¤è¾¹æ¡† */
            background-color: #2ECC71;
            /* æ›´æ¢èƒŒæ™¯é¢œè‰²ä¸ºæ¸…æ–°çš„ç»¿è‰² */
            color: #FFFFFF;
            text-align: center;
            line-height: 1.5;
            /* è°ƒæ•´è¡Œé«˜ï¼Œè®©æ–‡æœ¬æ›´æ˜“è¯» */
            transition: all 0.3s ease;
            /* æ·»åŠ è¿‡æ¸¡æ•ˆæœï¼Œä½¿å…¶æ˜¾ç¤ºå’Œéšè—æ—¶æ›´åŠ å¹³æ»‘ */
        }

        /* å½“é¼ æ ‡æ‚¬åœåœ¨æ¶ˆæ¯ä¸Šæ—¶ï¼Œç¨å¾®æ”¹å˜å…¶å¤–è§‚ */
        .tooltip:hover {
            background-color: #28C76F;
            /* æ”¹å˜èƒŒæ™¯é¢œè‰² */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15), 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .floating-heart-btn {
            position: fixed;
            bottom: 50px;
            right: 100px;
            padding: 10px 15px;
            opacity: 0.5;
            color: blue;
            border-radius: 20px;
            text-decoration: none;
            font-size: 13px;
            box-shadow: 0 4px 15px rgba(151, 169, 181, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 2px solid rgba(255, 255, 255, 0);
            animation: heartbeat 1.5s infinite;
        }

        .floating-heart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
            background: linear-gradient(135deg, #ff5252, #ff7d7d);
        }

        .floating-heart-btn::before {
            content: "";
            position: absolute;
            top: 0;
            margin-right: 10%;
            margin-bottom: 100px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .floating-heart-btn:hover::before {
            opacity: 1;
        }

        /* æ˜¥å­£èƒŒæ™¯ */
        body.spring {
            background-color: rgba(253, 235, 235, 0.7);
            box-shadow: inset 0 0 100px rgba(255, 220, 220, 0.5);
        }

        /* å¤å­£èƒŒæ™¯ */
        body.summer {
            background-color: rgba(201, 243, 184, 0.7);
            box-shadow: inset 0 0 100px rgba(200, 255, 200, 0.5);
        }

        /* ç§‹å­£èƒŒæ™¯ */
        body.autumn {
            background-color: rgba(255, 215, 163, 0.7);
            box-shadow: inset 0 0 100px rgba(255, 230, 200, 0.5);
        }

        /* å†¬å­£èƒŒæ™¯ */
        body.winter {
            background-color: rgba(224, 247, 250, 0.7);
            box-shadow: inset 0 0 100px rgba(220, 240, 255, 0.8);
        }

        .container {
            display: flex;
            flex-direction: row-reverse;
            width: 90%;
            max-width: 1200px;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            flex: 1;
            margin-top: 20px;
            margin-bottom: 20px;
            align-items: center;
            /* ä½¿å®¹å™¨å†…å…ƒç´ å‚ç›´å±…ä¸­ */
        }

        /* ç§»é™¤ä¸­é—´è¿‡æ¸¡æ•ˆæœ */
        .container::after {
            display: none;
        }

        .calendar-container {
            flex: 1;
            border-radius: 20px;
            padding: 20px;
            align-self: center;
            animation: fadeIn 1s ease-in-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
            /* ç¡®ä¿å†…è¾¹è·å’Œè¾¹æ¡†ä¸å¢åŠ å…ƒç´ å°ºå¯¸ */
        }

        .calendar-container:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .month-header {
            font-size: 32px;
            margin-bottom: 20px;
            color: #e91e63;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: slideInLeft 1s ease-in-out;
            background: -webkit-linear-gradient(#e91e63, #f48fb1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .days-of-week {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            background-color: rgba(244, 143, 177, 0.1);
            border-radius: 10px;
            padding: 5px 0;
        }

        .days-of-week div {
            flex: 1;
            padding: 10px 0;
            font-weight: bold;
            color: #e91e63;
            text-align: center;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .days div {
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            border-radius: 50%;
            text-align: center;
            position: relative;
        }

        .days div:hover {
            color: white;
            font-weight: bold;
            transform: scale(1.1);
            background-color: rgba(233, 30, 99, 0.1);
            box-shadow: 0 0 10px rgba(233, 30, 99, 0.2);
        }

        .days div.clicked {
            animation: clickEffect 0.5s;
        }

        @keyframes clickEffect {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
                background-color: #e91e63;
                color: white;
            }

            100% {
                transform: scale(1);
            }
        }

        .haveMsg {
            background-color: #ffb6c1;
            color: #8e44ad;
            font-weight: bold;
        }

        .haveMsg::after {
            content: 'ğŸ’Œ';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
        }

        .special-festival {
            position: relative;
            background: linear-gradient(135deg, #ff9de2 0%, #cca8e9 100%);
            color: #fff;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .special-festival::after {
            content: 'âœ¨';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            animation: sparkle 1.5s ease-in-out infinite;
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        }

        /* é—ªçƒåŠ¨ç”» */
        @keyframes sparkle {
            0% {
                opacity: 0.8;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.8;
            }
        }

        /* æ‚¬åœæ•ˆæœ */
        .special-festival:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 158, 226, 0.5);
        }

        /* æ–‡å­—æ•ˆæœ */
        .special-festival span {
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* å½“å¤©æ—¥æœŸæ ·å¼ */
        .today {
            background-color: rgba(233, 30, 99, 0.3);
            color: white;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(233, 30, 99, 0.5);
        }

        .message {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            line-height: 1.6;
            color: #8e44ad;
            text-align: left;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease-in-out forwards;
            min-width: 200px;
            width: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
            /* ç¡®ä¿å†…è¾¹è·å’Œè¾¹æ¡†ä¸å¢åŠ å…ƒç´ å°ºå¯¸ */
            max-height: calc(100vh - 210px);
            /* è®¾ç½®æœ€å¤§é«˜åº¦ï¼Œé¢„ç•™ä¸Šä¸‹ä½ç½® */
        }

        .message:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* æ¶ˆæ¯æ¡†æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .navigation {
            position: relative;
            width: calc(100% - 40px);
            padding: 5px 10px;
            display: flex;
            margin-top: 0px;
            margin-bottom: 50px;
            justify-content: center;
        }

        .navigation button {
            background-color: #f48fb1;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 25px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .navigation button:hover {
            background-color: #e91e63;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* æ¶ˆæ¯æ¡†æ ‡é¢˜æ ·å¼ */
        .message-title {
            font-size: 20px;
            font-weight: bold;
            color: #e91e63;
            margin-bottom: 10px;
        }

        /* ä¸åŒå­£èŠ‚ä¸‹çš„é˜´å½±æ•ˆæœ */
        body.spring.calendar-container,
        body.spring.message {
            box-shadow: 0 10px 20px rgba(255, 192, 203, 0.3), 0 0 30px rgba(255, 192, 203, 0.2);
        }

        body.summer.calendar-container,
        body.summer.message {
            box-shadow: 0 10px 20px rgba(144, 238, 144, 0.3), 0 0 30px rgba(144, 238, 144, 0.2);
        }

        body.autumn.calendar-container,
        body.autumn.message {
            box-shadow: 0 10px 20px rgba(255, 165, 0, 0.3), 0 0 30px rgba(255, 165, 0, 0.2);
        }

        body.winter.calendar-container,
        body.winter.message {
            box-shadow: 0 10px 20px rgba(173, 216, 230, 0.3), 0 0 30px rgba(173, 216, 230, 0.2);
        }

        body.spring.calendar-container:hover,
        body.spring.message:hover {
            box-shadow: 0 15px 30px rgba(255, 192, 203, 0.4), 0 0 40px rgba(255, 192, 203, 0.3);
        }

        body.summer.calendar-container:hover,
        body.summer.message:hover {
            box-shadow: 0 15px 30px rgba(144, 238, 144, 0.4), 0 0 40px rgba(144, 238, 144, 0.3);
        }

        body.autumn.calendar-container:hover,
        body.autumn.message:hover {
            box-shadow: 0 15px 30px rgba(255, 165, 0, 0.4), 0 0 40px rgba(255, 165, 0, 0.3);
        }

        body.winter.calendar-container:hover,
        body.winter.message:hover {
            box-shadow: 0 15px 30px rgba(173, 216, 230, 0.4), 0 0 40px rgba(173, 216, 230, 0.3);
        }

        .search-container {
            margin-top: 80px;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .search-container input {
            padding: 12px 15px;
            border: none;
            border-radius: 20px;
            width: 300px;
            margin-right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }

        .search-container input:focus {
            outline: none;
            background-color: #fff;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2), 0 0 5px rgba(233, 30, 99, 0.5);
        }

        .search-container button {
            background-color: #f48fb1;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 25px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .search-container button:hover {
            background-color: #e91e63;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .boyfriend-talk {
            color: #1e88e5;
        }

        .girlfriend-talk {
            color: #e91e63;
        }

        .message img {
            max-width: 85%;
            height: auto;
            display: block;
            margin: 10px 0;
        }

        /* è§†é¢‘æ’­æ”¾æ¡†å®¹å™¨ */
        .message-video {
            width: 100%;
            /* å®½åº¦è‡ªé€‚åº”çˆ¶å®¹å™¨ */
            max-width: 800px;
            /* æœ€å¤§å®½åº¦é™åˆ¶ */
            aspect-ratio: 16 / 9;
            /* è®¾ç½®å®½é«˜æ¯”ä¸º 16:9 */
            margin: 20px auto;
            /* ä¸Šä¸‹å¤–è¾¹è·ï¼Œæ°´å¹³å±…ä¸­ */
            border-radius: 16px;
            /* åœ†è§’æ•ˆæœ */
            overflow: hidden;
            /* é˜²æ­¢å†…å®¹æº¢å‡º */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            /* é˜´å½±æ•ˆæœ */
            position: relative;
        }

        /* æé«˜è§†é¢‘äº®åº¦ */
        .message-video video {
            filter: brightness(1.3);
            /* å¢åŠ è§†é¢‘äº®åº¦ */
        }

        /* è‡ªé€‚åº”å¸ƒå±€ */
        @media (max-width: 768px) {
            .message-video {
                max-width: 100%;
                /* åœ¨å°å±å¹•è®¾å¤‡ä¸Šå æ»¡å®½åº¦ */
            }
        }

        /* æ§åˆ¶å™¨æ•´ä½“æ ·å¼ */
        .message-video::-webkit-media-controls {
            background-color: transparent;
            /* ç§»é™¤æ§åˆ¶å™¨èƒŒæ™¯è‰² */
            padding: 2px;
            /* å†…è¾¹è· */
        }

        /* æ’­æ”¾/æš‚åœæŒ‰é’®ä¼˜åŒ– */
        .message-video::-webkit-media-controls-play-button,
        .message-video::-webkit-media-controls-pause-button {
            align-items: center;
            justify-content: center;
            width: 40px;
            /* æŒ‰é’®å¤§å° */
            height: 40px;
            /* æŒ‰é’®å¤§å° */
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
            /* æ·»åŠ åŠ¨ç”» */
        }

        /* æŒ‰é’®å†…éƒ¨çš„ä¸‰è§’å½¢ï¼ˆæ’­æ”¾å›¾æ ‡ï¼‰ */
        .message-video::-webkit-media-controls-play-button::before,
        .message-video::-webkit-media-controls-pause-button::before {
            content: "";
            /* ä½¿ç”¨ä¼ªå…ƒç´ ç»˜åˆ¶ä¸‰è§’å½¢ */
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 6px 0 6px 10px;
            /* ç»˜åˆ¶ç­‰è…°ä¸‰è§’å½¢ */
            border-color: transparent transparent transparent #fff;
            /* ç™½è‰²ä¸‰è§’å½¢ */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* å±…ä¸­å¯¹é½ */
        }

        /* æš‚åœæŒ‰é’®çš„æ ·å¼ */
        .message-video::-webkit-media-controls-pause-button::before {
            border: none;
            /* ç§»é™¤ä¸‰è§’å½¢ */
            content: "||";
            /* æ˜¾ç¤ºä¸¤æ¡ç«–çº¿è¡¨ç¤ºæš‚åœ */
            font-size: 14px;
            /* å­—ä½“å¤§å° */
            font-weight: bold;
            /* åŠ ç²—å­—ä½“ */
            color: #fff;
            /* æ–‡å­—é¢œè‰² */
        }

        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .message-video::-webkit-media-controls-play-button:hover,
        .message-video::-webkit-media-controls-pause-button:hover {
            transform: scale(1.1);
            /* è½»å¾®æ”¾å¤§æ•ˆæœ */
        }

        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .message-video::-webkit-media-controls-play-button:active,
        .message-video::-webkit-media-controls-pause-button:active {
            transform: scale(0.95);
            /* ç‚¹å‡»æ—¶ç¼©å° */
        }


        /* æ—¶é—´è½´æ ·å¼ */
        .message-video::-webkit-media-controls-timeline {
            width: 100%;
            /* æ—¶é—´è½´å®½åº¦ */
            height: 4px;
            /* æ—¶é—´è½´é«˜åº¦ */
            background-color: rgba(255, 255, 255, 0.1);
            /* åŠé€æ˜èƒŒæ™¯è‰² */
            border-radius: 2px;
            /* åœ†è§’æ—¶é—´è½´ */
        }

        .message-video::-webkit-media-controls-timeline::-webkit-slider-runnable-track {
            background: linear-gradient(to right, #ff5722, #f44336);
            /* æ¸å˜è¿›åº¦æ¡ */
            border-radius: 2px;
            /* åœ†è§’ */
        }

        /* éŸ³é‡æ§åˆ¶ä¼˜åŒ– */
        .message-video::-webkit-media-controls-volume-slider {
            width: 60px;
            /* ç¼©çŸ­éŸ³é‡æ»‘å—å®½åº¦ */
            height: 4px;
            /* å‡å°éŸ³é‡æ»‘å—é«˜åº¦ */
            border-radius: 2px;
            /* åœ†è§’ */
            margin-left: 12px;
            /* é è¿‘å–‡å­å›¾æ ‡ */
        }

        .message-video::-webkit-media-controls-volume-slider::-webkit-slider-thumb {
            background-color: #ff5722;
            /* æ»‘å—é¢œè‰² */
            border-radius: 50%;
            /* åœ†å½¢æ»‘å— */
            width: 12px;
            /* æ»‘å—å¤§å° */
            height: 4px;
            /* æ»‘å—å¤§å° */
            cursor: pointer;
            /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹å‹ */
        }

        /* æ—¶é—´æ–‡å­—æ ·å¼ */
        .message-video::-webkit-media-controls-current-time-display,
        .message-video::-webkit-media-controls-time-remaining-display {
            color: #fff;
            /* æ–‡å­—é¢œè‰² */
            font-size: 12px;
            /* å­—ä½“å¤§å° */
            font-family: 'Arial', sans-serif;
            /* å­—ä½“ */
        }

        .spaceMessage{
            color: #0DCEDA;
			font-weight: bold;
        }
    </style>
</head>

<body>
    <a href="./loveEdit.html" class="floating-heart-btn">â¤ï¸æ—¥å†ç©ºé—´</a>
    <div class="search-container">
        <input type="text" autocomplete="off" id="search-input" placeholder="å…³é”®å­— æ—¥æœŸ [YYYYMMDD] å¹´æœˆ[YYYYMM]">
        <button id="search-button">æœç´¢</button>
    </div>

    <div class="container">
        <div class="message" id="message"></div>
        <div class="calendar-container">
            <div class="calendar" id="calendar"></div>
        </div>
    </div>
    <div class="navigation">
        <button id="prevYear">ä¸Šä¸€å¹´</button>
        <button id="prevMonth">ä¸Šä¸ªæœˆ</button>
        <button id="nextMonth">ä¸‹ä¸ªæœˆ</button>
        <button id="nextYear">ä¸‹ä¸€å¹´</button>
    </div>

    <script src="./message.js"></script>
    <script src="./spaceDate.js"></script>
    <script>
        const calendar = document.getElementById('calendar');
        const messageBox = document.getElementById('message');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const prevYearBtn = document.getElementById('prevYear');
        const nextYearBtn = document.getElementById('nextYear');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        // è·å–å½“å‰æ—¥æœŸ
        let currentDate = new Date();

        // æœ€æ—©æ—¥æœŸé™åˆ¶
        const earliestDate = new Date(2024, 2, 1);

        const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDay = new Date(year, month + 1, 0).getDate();

            const fragment = document.createDocumentFragment();
            fragment.appendChild(createMonthHeader(year, month));
            fragment.appendChild(createDaysOfWeek());
            fragment.appendChild(createDays(year, month, firstDay, lastDay));

            calendar.innerHTML = '';
            calendar.appendChild(fragment);

            // åˆ‡æ¢æœˆä»½æ—¶è‡ªåŠ¨æ›´æ¢èƒŒæ™¯
            changeSeasonBackground(month);

            // åŠ¨æ€è®¾ç½®æ¶ˆæ¯æ¡†é«˜åº¦
            setMessageBoxHeight();
        }

        function createMonthHeader(year, month) {
            const monthHeader = document.createElement('div');
            monthHeader.classList.add('month-header');
            monthHeader.textContent = `${year}å¹´ ${month + 1}æœˆ`;
            return monthHeader;
        }

        function createDaysOfWeek() {
            const daysOfWeek = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const daysOfWeekDiv = document.createElement('div');
            daysOfWeekDiv.classList.add('days-of-week');
            daysOfWeek.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                daysOfWeekDiv.appendChild(dayDiv);
            });
            return daysOfWeekDiv;
        }

        function createDays(year, month, firstDay, lastDay) {
            const daysDiv = document.createElement('div');
            daysDiv.classList.add('days');

            // å¡«å……ç©ºç™½æ—¥æœŸ
            for (let i = 0; i < firstDay; i++) {
                const emptyDiv = document.createElement('div');
                daysDiv.appendChild(emptyDiv);
            }

            const today = new Date();
            // å¡«å……æ—¥æœŸ
            for (let day = 1; day <= lastDay; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                const dateKey = `${year}${String(month + 1).padStart(2, '0')}${String(day).padStart(2, '0')}`;
                if (messages[dateKey]) {
                    dayDiv.classList.add('haveMsg');
                }
                if (specialFestivals[dateKey]) {
                    dayDiv.classList.add('special-festival');
                    dayDiv.title = specialFestivals[dateKey];
                }
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayDiv.classList.add('today');
                }
                dayDiv.addEventListener('click', () => {
                    dayDiv.classList.add('clicked');
                    setTimeout(() => {
                        dayDiv.classList.remove('clicked');
                    }, 500);
                    showMessage(dateKey);
                });
                daysDiv.appendChild(dayDiv);
            }
            return daysDiv;
        }

        function showMessage(dateKey) {
            document.getElementById('search-input').value = '';
            const year = parseInt(dateKey.slice(0, 4));
            const month = parseInt(dateKey.slice(4, 6)) - 1;
            const day = parseInt(dateKey.slice(6, 8));
            const dateObj = new Date(year, month, day);
            const weekDay = weekDays[dateObj.getDay()];
            let messageTitle = `<div class="message-title">${year}å¹´${month + 1}æœˆ${day}æ—¥ ${weekDay}</div>`;
            let messageContent = messages[dateKey] || 'ä»Šå¤©æ²¡æœ‰å¤§äº‹å‘ç”Ÿï¼Œä½†ä¹Ÿæ˜¯å¥½çˆ±å¥³æœ‹å‹çš„ä¸€å¤©ï¼';
            if (specialFestivals[dateKey]) {
                if (!messages[dateKey]) {
                    messageContent = '';
                }
                messageContent = `<span class="spaceMessage">ä»Šå¤©${specialFestivals[dateKey]}</span><br>` + messageContent;
                showTooltip('ä»Šå¤©' + specialFestivals[dateKey]);
            }

            // å¤„ç†å¯¹è¯é¢œè‰²
            messageContent = messageContent.replace(/(ç”·æœ‹å‹ï¼š)(.*?"ã€‚)/g, '<span class="boyfriend-talk">$1$2</span>');
            messageContent = messageContent.replace(/(å¥³æœ‹å‹ï¼š)(.*?"ã€‚)/g, '<span class="girlfriend-talk">$1$2</span>');

            // åœ¨â€œç”·æœ‹å‹ï¼šâ€å’Œâ€œå¥³æœ‹å‹ï¼šâ€å‰é¢åŠ æ¢è¡Œ
            //messageContent = messageContent.replace(/(ç”·æœ‹å‹ï¼š)/g, '<br>$1');
            //messageContent = messageContent.replace(/(å¥³æœ‹å‹ï¼š)/g, '<br>$1');
            messageContent = messageContent.replace(/(HL)/g, '<br>');

            // å¤„ç†å›¾ç‰‡æ’å…¥
            messageContent = messageContent.replace(/"(\.\/.*?\.(png|jpeg|jpg|heic))"/g, '<img src="$1" alt="Message Image">');

            // å¤„ç†è§†é¢‘æ’å…¥
            messageContent = messageContent.replace(/"(\.\/.*?\.(mp4))"/g, '<video controls class="message-video"><source src="$1" type="video/mp4">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚</video>');

            messageBox.innerHTML = messageTitle + messageContent;

            // æ›´æ–°æ¶ˆæ¯æ¡†é«˜åº¦
            setMessageBoxHeight();
        }

        function changeSeasonBackground(month) {
            const body = document.body;
            body.classList.remove('spring', 'summer', 'autumn', 'winter');

            if (month >= 2 && month < 5) {
                body.classList.add('spring');
            } else if (month >= 5 && month < 8) {
                body.classList.add('summer');
            } else if (month >= 8 && month < 11) {
                body.classList.add('autumn');
            } else {
                body.classList.add('winter');
            }
        }

        function setMessageBoxHeight() {
            const calendarContainer = document.querySelector('.calendar-container');
            const calendarHeight = calendarContainer.clientHeight;
            const messageBoxHeight = messageBox.scrollHeight;

            if (messageBoxHeight < calendarHeight) {
                messageBox.style.height = `${calendarHeight}px`;
            } else {
                messageBox.style.minHeight = `${calendarHeight}px`;
                messageBox.style.height = 'auto';
            }
        }

        function search() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm === '') return;

            // å…ˆå°è¯•æ—¥æœŸæœç´¢
            if (/^\d{8}$/.test(searchTerm)) {
                const searchYear = parseInt(searchTerm.slice(0, 4));
                const searchMonth = parseInt(searchTerm.slice(4, 6)) - 1;
                const searchDate = new Date(searchYear, searchMonth, 1);

                if (searchDate < earliestDate) {
                    showTooltip('æœ€æ—©æ—¥æœŸä¸º 2024 å¹´ 3 æœˆ 13æ—¥ï¼Œè¯·è¾“å…¥è¯¥æ—¥æœŸä¹‹åçš„æ—¥æœŸã€‚');
                    return;
                }

                if (messages[searchTerm]) {
                    currentDate.setFullYear(searchYear);
                    currentDate.setMonth(searchMonth);
                    renderCalendar();
                    showMessage(searchTerm);
                    return;
                }
            }

            // å°è¯•å¹´æœˆæœç´¢
            if (/^\d{6}$/.test(searchTerm)) {
                const searchYear = parseInt(searchTerm.slice(0, 4));
                const searchMonth = parseInt(searchTerm.slice(4, 6)) - 1;
                const searchDate = new Date(searchYear, searchMonth, 1);

                if (searchDate < earliestDate) {
                    showTooltip('æœ€æ—©æ—¥æœŸä¸º 2024 å¹´ 3 æœˆ 13 æ—¥ï¼Œè¯·è¾“å…¥è¯¥æ—¥æœŸä¹‹åçš„å¹´æœˆæ—¥ã€‚');
                    return;
                }

                currentDate.setFullYear(searchYear);
                currentDate.setMonth(searchMonth);
                renderCalendar();
                return;
            }

            // æ¨¡ç³Šæœç´¢æ¶ˆæ¯å†…å®¹
            for (const [dateKey, message] of Object.entries(messages)) {
                if (message.includes(searchTerm)) {
                    const year = parseInt(dateKey.slice(0, 4));
                    const month = parseInt(dateKey.slice(4, 6)) - 1;
                    const day = parseInt(dateKey.slice(6, 8));
                    currentDate.setFullYear(year);
                    currentDate.setMonth(month);
                    renderCalendar();
                    showMessage(dateKey);
                    return;
                }
            }

            showTooltip('æœªæ‰¾åˆ°åŒ¹é…çš„æ¶ˆæ¯ã€æ—¥æœŸæˆ–å¹´æœˆã€‚');
        }

        prevMonthBtn.addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            const newDate = new Date(currentDate);
            newDate.setMonth(newDate.getMonth() - 1);
            if (newDate < earliestDate) {
                showTooltip('æœ€æ—©æ—¥æœŸä¸º 2024 å¹´ 3 æœˆï¼Œæ— æ³•æŸ¥çœ‹æ›´æ—©çš„æœˆä»½ã€‚');
                return;
            }
            currentDate = newDate;
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        prevYearBtn.addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            const newDate = new Date(currentDate);
            newDate.setFullYear(newDate.getFullYear() - 1);
            if (newDate < earliestDate) {
                showTooltip('æœ€æ—©æ—¥æœŸä¸º 2024 å¹´ 3 æœˆï¼Œæ— æ³•æŸ¥çœ‹æ›´æ—©çš„å¹´ä»½ã€‚');
                currentDate.setFullYear(2024);
                currentDate.setMonth(2);
            } else {
                currentDate = newDate;
            }
            renderCalendar();
        });

        nextYearBtn.addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            currentDate.setFullYear(currentDate.getFullYear() + 1);
            renderCalendar();
        });

        searchButton.addEventListener('click', search);

        searchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                search();
            }
        });

        // é”®ç›˜å¿«æ·é”®åˆ‡æ¢æœˆä»½
        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowLeft') {
                const newDate = new Date(currentDate);
                newDate.setMonth(newDate.getMonth() - 1);
                if (newDate < earliestDate) {
                    showTooltip('æœ€æ—©æ—¥æœŸä¸º 2024 å¹´ 3 æœˆï¼Œæ— æ³•æŸ¥çœ‹æ›´æ—©çš„æœˆä»½ã€‚');
                    return;
                }
                currentDate = newDate;
                renderCalendar();
            } else if (event.key === 'ArrowRight') {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            }
        });

        // åˆå§‹åŒ–æ˜¾ç¤ºå½“å¤©æ—¥æœŸçš„æ¶ˆæ¯å’ŒèƒŒæ™¯
        const today = new Date();
        if (today < earliestDate) {
            currentDate = earliestDate;
        }
        const todayKey = `${currentDate.getFullYear()}${String(currentDate.getMonth() + 1).padStart(2, '0')}${String(currentDate.getDate()).padStart(2, '0')}`;
        showMessage(todayKey);
        changeSeasonBackground(currentDate.getMonth());
        renderCalendar();


        let tooltips = []; // å­˜å‚¨æ‰€æœ‰å¼¹æ¡†çš„å¼•ç”¨

        function fadeAndHideTooltip(tooltip) {
            tooltip.style.opacity = 0; // å¼€å§‹æ·¡å‡º  
            setTimeout(() => {
                tooltip.remove(); // ä»DOMä¸­ç§»é™¤
                // å¯é€‰ï¼šä»tooltipsæ•°ç»„ä¸­ç§»é™¤è¯¥å¼•ç”¨  
                tooltips = tooltips.filter(t => t !== tooltip);
            }, 350); // æ·¡å‡ºæ—¶é—´  
        }

        function showTooltip(message) {
            const tooltip = document.createElement('div');
            tooltip.classList.add('tooltip');
            tooltip.textContent = message;
            document.body.appendChild(tooltip);

            // å­˜å‚¨å¼•ç”¨ä»¥ä¾¿åç»­ç®¡ç†  
            tooltips.push(tooltip);
            // è®¾ç½®å®šæ—¶å™¨éšè—å¼¹æ¡†  
            setTimeout(() => {
                fadeAndHideTooltip(tooltip);
            }, 3500);
        }

    </script>
</body>

</html>